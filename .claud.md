# Prayer Reminder iOS App - Development Guide

## Project Overview

Build a minimal, refreshing Islamic prayer notification app for iOS that helps users stay connected to their daily prayers. The app focuses on simplicity with a clean UI showing current and next prayer times, with optional week/month views.

**Target**: iOS 17+, SwiftUI, iPhone only

---

## Key Requirements

### Core Features
- ✅ Onboarding: Name capture + GPS location setup
- ✅ Main UI: Show current prayer (just passed) and next prayer with countdown
- ✅ Prayer times: Fetch from Aladhan API once daily (or on location change)
- ✅ Notifications: All 5 prayers, individually toggleable, timing options (at time, 5/10/15 min before)
- ✅ Widgets: Home screen (small/medium/large) and lock screen widgets
- ✅ Settings: Calculation method, location, theme, notification preferences
- ✅ iCloud sync: Settings sync across devices
- ✅ Week/Month views: Calendar views accessible via sidebar/navigation

### Design Requirements
- **Islamic aesthetic**: White and green color palette, crescent moon motifs, geometric patterns
- **No emojis** in any app text
- **Minimal UI**: Focus on current and next prayer only
- **Optional Gregorian date**: Configurable in settings
- **Dark mode support**

### API Integration
- **Aladhan API**: `https://api.aladhan.com/v1/timings/{timestamp}`
- Parameters: latitude, longitude, method (calculation method ID)
- Fetch once per day, on app launch (if not cached), midnight transition, and location changes

---

## Project Structure

```
PrayerReminder/
├── PrayerReminderApp.swift          # App entry point
├── Models/
│   ├── PrayerTime.swift             # Prayer time data model (SwiftData)
│   ├── UserSettings.swift           # User preferences (SwiftData + CloudKit)
│   ├── Location.swift               # Location data
│   └── CalculationMethod.swift      # Calculation methods enum
├── ViewModels/
│   ├── PrayerViewModel.swift        # Main prayer logic
│   ├── OnboardingViewModel.swift    # Onboarding flow
│   └── SettingsViewModel.swift      # Settings management
├── Views/
│   ├── Onboarding/
│   │   ├── WelcomeView.swift
│   │   ├── NameInputView.swift
│   │   ├── LocationSetupView.swift
│   │   └── NotificationPermissionView.swift
│   ├── Main/
│   │   ├── MainPrayerView.swift     # Primary prayer display
│   │   ├── PrayerDetailView.swift   # Expandable all prayers
│   │   ├── WeekView.swift           # Week calendar
│   │   └── MonthView.swift          # Month calendar
│   ├── Settings/
│   │   ├── SettingsView.swift
│   │   ├── ProfileSettingsView.swift
│   │   ├── PrayerSettingsView.swift
│   │   └── AppearanceSettingsView.swift
│   └── Components/
│       ├── PrayerCard.swift         # Reusable prayer display
│       ├── IslamicPattern.swift     # Decorative elements
│       └── CrescentMoon.swift       # Islamic icon
├── Services/
│   ├── PrayerTimeService.swift      # API integration
│   ├── NotificationService.swift    # Notification scheduling
│   ├── LocationService.swift        # Location management
│   └── CloudSyncService.swift       # iCloud sync
├── Widgets/
│   ├── PrayerWidget.swift           # Home screen widgets
│   ├── LockScreenWidget.swift       # Lock screen widgets
│   └── WidgetProvider.swift         # Timeline provider
├── Utilities/
│   ├── DateFormatter+Extensions.swift
│   ├── Color+Theme.swift            # Color palette
│   └── Constants.swift
└── Resources/
    ├── Assets.xcassets
    └── Info.plist
```

---

## Data Models

### PrayerTime (SwiftData)
```swift
@Model
class PrayerTime {
    var date: Date
    var fajr: Date
    var dhuhr: Date
    var asr: Date
    var maghrib: Date
    var isha: Date
    var hijriDate: String
    var location: Location
    
    // Computed properties
    var allPrayers: [(name: String, time: Date)] { ... }
    var currentPrayer: (name: String, time: Date)? { ... }
    var nextPrayer: (name: String, time: Date)? { ... }
}
```

### UserSettings (SwiftData + CloudKit)
```swift
@Model
class UserSettings {
    var userName: String
    var location: Location
    var calculationMethod: CalculationMethod
    var enabledPrayers: [String: Bool]  // Prayer name -> enabled
    var notificationTimings: [String: Int]  // Prayer name -> minutes before
    var theme: AppTheme
    var showGregorianDate: Bool
    var autoUpdateLocation: Bool
    var lastSyncDate: Date?
}
```

### Location
```swift
struct Location: Codable {
    var latitude: Double
    var longitude: Double
    var city: String
    var country: String
    var isManual: Bool
}
```

### CalculationMethod
```swift
enum CalculationMethod: Int, Codable, CaseIterable {
    case muslimWorldLeague = 3
    case isna = 2
    case egyptian = 5
    case ummAlQura = 4
    // ... other methods
    
    var displayName: String { ... }
    var apiValue: Int { ... }
}
```

---

## Services Implementation

### 1. PrayerTimeService
**Responsibilities**: Fetch prayer times from Aladhan API, cache locally

```swift
class PrayerTimeService {
    func fetchPrayerTimes(
        for date: Date,
        location: Location,
        method: CalculationMethod
    ) async throws -> PrayerTime {
        // 1. Build API URL with timestamp, lat, lon, method
        // 2. Make network request
        // 3. Parse JSON response
        // 4. Create PrayerTime model
        // 5. Save to SwiftData
        // 6. Return result
    }
    
    func getCachedPrayerTimes(for date: Date) -> PrayerTime? {
        // Query SwiftData for cached times
    }
}
```

**API Example**:
```
GET https://api.aladhan.com/v1/timings/1708185600?latitude=37.7749&longitude=-122.4194&method=2
```

**Response Structure**:
```json
{
  "data": {
    "timings": {
      "Fajr": "05:30",
      "Dhuhr": "12:45",
      "Asr": "15:45",
      "Maghrib": "18:15",
      "Isha": "19:45"
    },
    "date": {
      "hijri": {
        "date": "15-08-1447",
        "day": "15",
        "month": { "en": "Sha'ban" },
        "year": "1447"
      }
    }
  }
}
```

### 2. NotificationService
**Responsibilities**: Schedule local notifications for prayer times

```swift
class NotificationService {
    func scheduleNotifications(for prayerTimes: PrayerTime, settings: UserSettings) {
        // 1. Cancel existing notifications
        // 2. For each enabled prayer:
        //    - Calculate notification time (exact or X minutes before)
        //    - Create notification content (personalized with user name)
        //    - Schedule notification
        // 3. Update app badge
    }
    
    func requestPermission() async -> Bool {
        // Request notification authorization
    }
}
```

**Notification Content**:
- Title: "{Prayer Name} Prayer"
- Body: "{User Name}, it's time for {Prayer Name} prayer"
- Sound: Default iOS notification sound

### 3. LocationService
**Responsibilities**: Get GPS coordinates, reverse geocode to city

```swift
class LocationService: NSObject, ObservableObject, CLLocationManagerDelegate {
    private let locationManager = CLLocationManager()
    @Published var currentLocation: Location?
    
    func requestPermission() { ... }
    func getCurrentLocation() async -> Location? { ... }
    func startMonitoring locationChanges() { ... }
    func geocodeLocation(_ coordinate: CLLocationCoordinate2D) async -> String? { ... }
}
```

### 4. CloudSyncService
**Responsibilities**: Sync UserSettings to iCloud via CloudKit

```swift
class CloudSyncService {
    private let container = CKContainer.default()
    
    func syncSettings(_ settings: UserSettings) async throws {
        // 1. Convert settings to CKRecord
        // 2. Save to CloudKit private database
        // 3. Update lastSyncDate
    }
    
    func fetchSettings() async throws -> UserSettings? {
        // 1. Query CloudKit for settings record
        // 2. Convert CKRecord to UserSettings
        // 3. Return settings
    }
}
```

---

## UI Design System

### Color Palette
```swift
extension Color {
    // Light Mode
    static let primaryGreen = Color(hex: "#2D6A4F")
    static let accentGold = Color(hex: "#D4AF37")
    static let backgroundLight = Color(hex: "#F8F9FA")
    static let textPrimary = Color(hex: "#212529")
    
    // Dark Mode
    static let primaryGreenDark = Color(hex: "#52B788")
    static let backgroundDark = Color(hex: "#1A1D29")
    static let textPrimaryDark = Color(hex: "#E9ECEF")
}
```

### Typography
```swift
extension Font {
    static let appTitle = Font.system(size: 32, weight: .bold, design: .rounded)
    static let prayerName = Font.system(size: 24, weight: .semibold)
    static let prayerTime = Font.system(size: 48, weight: .bold, design: .rounded)
    static let body = Font.system(size: 16, weight: .regular)
}
```

### Islamic Design Elements
- Crescent moon icon (custom SwiftUI Shape)
- Geometric patterns (subtle background)
- Green and gold color accents
- Generous spacing and white space

---

## Main Prayer View Layout

```
┌─────────────────────────────────┐
│  Assalamu Alaikum, Ahmed        │
│  Monday, Feb 17, 2026           │  ← Optional (configurable)
│  15 Sha'ban 1447                │  ← Hijri date
├─────────────────────────────────┤
│                                 │
│  CURRENT PRAYER                 │
│  Dhuhr                          │
│  12:45 PM                       │
│  ✓ Completed                    │
│                                 │
├─────────────────────────────────┤
│                                 │
│  NEXT PRAYER                    │
│  Asr                            │
│  3:45 PM                        │
│  in 2 hours 34 minutes          │
│                                 │
├─────────────────────────────────┤
│  [View All Prayer Times]        │
└─────────────────────────────────┘
```

**Interactions**:
- Tap "View All Prayer Times" → Expands to show all 5 prayers
- Swipe left/right → Navigate to Week/Month views
- Pull to refresh → Manually fetch prayer times

---

## Widget Implementation

### Home Screen Widgets

**Small (2x2)**:
```
┌─────────────┐
│ Next Prayer │
│    Asr      │
│  3:45 PM    │
│ in 2h 34m   │
└─────────────┘
```

**Medium (4x2)**:
```
┌───────────────────────────┐
│ Current: Dhuhr (12:45 PM) │
│ Next Prayer: Asr          │
│ 3:45 PM                   │
│ in 2 hours 34 minutes     │
└───────────────────────────┘
```

**Large (4x4)**:
```
┌───────────────────────────┐
│ Today's Prayer Times      │
│ Fajr      5:30 AM    ✓    │
│ Dhuhr    12:45 PM    ✓    │
│ Asr       3:45 PM    →    │
│ Maghrib   6:15 PM         │
│ Isha      7:45 PM         │
└───────────────────────────┘
```

**Timeline Updates**:
- Update every 15 minutes
- Update at each prayer time
- Update when prayer times refresh in main app

### Lock Screen Widgets

**Circular**: Asr / 3:45  
**Rectangular**: Next: Asr 3:45PM  
**Inline**: Next: Asr at 3:45 PM

---

## Onboarding Flow

1. **Welcome**: App logo with crescent moon, brief description, "Get Started" button
2. **Name Input**: "What's your name?" with text field
3. **Location Setup**: Request location permission, show detected city, option for manual entry
4. **Notification Permission**: Request notification access
5. **Complete**: "You're all set!" → Navigate to main app

**State**: Use `@AppStorage` to track onboarding completion

---

## Settings Screen Structure

### Profile Settings
- Name input
- Location display with "Update" button
- Auto-update location toggle

### Prayer Settings
- Calculation method picker
- For each prayer (Fajr, Dhuhr, Asr, Maghrib, Isha):
  - Enable/disable toggle
  - Notification timing: At time / 5 / 10 / 15 min before
- Show Gregorian date toggle

### Appearance
- Theme: Light / Dark / System

### Data & Sync
- iCloud sync toggle
- Last sync timestamp
- Manual refresh button

---

## Development Phases

### Phase 1: Core Foundation
1. Create Xcode project (iOS App, SwiftUI, SwiftData)
2. Implement data models (PrayerTime, UserSettings, Location, CalculationMethod)
3. Build PrayerTimeService with Aladhan API integration
4. Create basic SwiftData persistence
5. Test API fetching and caching

### Phase 2: Onboarding & Main UI
1. Build onboarding flow (4 screens)
2. Implement LocationService
3. Create MainPrayerView with current/next prayer
4. Add expandable all prayers view
5. Implement NotificationService
6. Test notification scheduling

### Phase 3: Settings & Advanced Features
1. Build settings screens (all sections)
2. Implement week/month calendar views
3. Add Islamic design elements (crescent moon, patterns)
4. Implement theme switching
5. Polish UI/UX with animations

### Phase 4: Widgets & Sync
1. Create home screen widgets (small, medium, large)
2. Create lock screen widgets (circular, rectangular, inline)
3. Implement CloudSyncService
4. Add iCloud sync functionality
5. Test sync across devices

### Phase 5: Testing & Polish
1. Write unit tests (services, view models)
2. Manual testing on simulator
3. Bug fixes and refinements
4. Performance optimization
5. Accessibility improvements (VoiceOver, Dynamic Type)

---

## Testing Checklist

### Simulator Testing
- [ ] Complete onboarding flow
- [ ] Verify prayer times fetched for Cupertino (default simulator location)
- [ ] Check current/next prayer display
- [ ] Test "View All Prayer Times" expansion
- [ ] Change location in simulator → verify times update
- [ ] Toggle prayer notifications in settings
- [ ] Change calculation method → verify times update
- [ ] Switch theme → verify UI updates
- [ ] Add widgets to home screen → verify data
- [ ] Test week/month views

### Notification Testing
- [ ] Schedule notification for next prayer
- [ ] Verify notification appears in Notification Center
- [ ] Test different timing options (at time, 5/10/15 min before)
- [ ] Verify personalized message with user name

### iCloud Sync Testing (requires 2 devices)
- [ ] Change settings on Device A
- [ ] Verify settings sync to Device B within 30 seconds
- [ ] Test conflict resolution

---

## Important Notes

### API Rate Limits
- Aladhan API is free with no strict rate limits
- Cache prayer times locally to minimize requests
- Only fetch once per day or on location change

### Permissions Required
- **Location (When In Use)**: For prayer time calculation
- **Notifications**: For prayer reminders
- **iCloud (Optional)**: For settings sync

### Privacy
- Location data never leaves device except for API calls
- No user tracking or analytics
- No third-party data sharing
- All data stored locally and in user's iCloud

### Beginner Tips
- Use Xcode's SwiftUI preview for rapid UI iteration
- Test on simulator first before physical device
- Use `print()` statements for debugging
- Xcode's breakpoints are your friend
- Read compiler errors carefully - they're usually helpful

---

## Reference Documentation

- [Aladhan API Docs](https://aladhan.com/prayer-times-api)
- [SwiftUI Documentation](https://developer.apple.com/documentation/swiftui)
- [SwiftData Documentation](https://developer.apple.com/documentation/swiftdata)
- [WidgetKit Documentation](https://developer.apple.com/documentation/widgetkit)
- [UserNotifications Documentation](https://developer.apple.com/documentation/usernotifications)
- [CloudKit Documentation](https://developer.apple.com/documentation/cloudkit)

---

## Quick Start Commands

```bash
# Open Xcode project
open PrayerReminder.xcodeproj

# Run on simulator (or use Xcode GUI: ⌘ + R)
xcodebuild -scheme PrayerReminder -destination 'platform=iOS Simulator,name=iPhone 17 Pro'

# Run tests (or use Xcode GUI: ⌘ + U)
xcodebuild test -scheme PrayerReminder
```

---

**Ready to build!** Start with Phase 1: Create the Xcode project and implement the data models and API service.
